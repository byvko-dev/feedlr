datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator db {
  provider = "go run github.com/prisma/prisma-client-go"
  // set the output folder and package name
  output   = "./client"
  package  = "prisma"
}

model Guild {
  id        String   @id @map("_id")
  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")

  discordId String @map("discordId")

  name  String @map("name")
  feeds Feed[]

  @@index([name], name: "name")
  @@map("guilds")
}

model Feed {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")

  guildId String @map("guildId")
  Guild   Guild  @relation(fields: [guildId], references: [id])

  url      String    @map("url")
  webhooks Webhook[] @relation()

  @@index([url], name: "url")
  @@map("feeds")
}

model Webhook {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt DateTime @default(now()) @map("createdAt")
  updatedAt DateTime @updatedAt @map("updatedAt")

  url String @map("url")

  feed   Feed   @relation(fields: [feedId], references: [id])
  feedId String @map("feedId") @db.ObjectId

  @@index([url], name: "url")
  @@map("webhooks")
}
